<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toi-Shashu.kz - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Serif:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Cormorant+Garamond:ital,wght@0,400;0,700;1,400;1,700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 320px 1fr 380px;
            min-height: 700px;
        }

        .templates-panel {
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
        }

        .templates-panel h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.2em;
        }

        .template-item {
            width: 100%;
            height: 160px;
            margin-bottom: 15px;
            border: 3px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .template-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .template-item:hover::after {
            opacity: 1;
        }

        .template-item:hover {
            border-color: #4ecdc4;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .template-item.active {
            border-color: #ff6b6b;
            transform: scale(1.02);
        }

        .template-name {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .template-item:hover .template-name {
            opacity: 1;
        }

        .canvas-area {
            padding: 20px 40px 40px 40px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            background: #f8f9fa;
        }

        .canvas-container {
            position: relative;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        #canvas {
            display: block;
            max-width: 100%;
            height: auto;
            max-height: 600px;
            cursor: grab;
        }

        #canvas:active {
            cursor: grabbing;
        }

        .controls-panel {
            background: white;
            padding: 30px;
            border-left: 1px solid #e9ecef;
            overflow-y: auto;
            max-height: 100vh;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        .control-group input, .control-group textarea, .control-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .control-group input:focus, .control-group textarea:focus, .control-group select:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .control-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .color-input {
            height: 45px;
            padding: 5px;
            cursor: pointer;
        }

        .range-input {
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e9ecef;
            outline: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
        }

        .text-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .text-style-btn {
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .text-style-btn.active {
            border-color: #4ecdc4;
            background: #4ecdc4;
            color: white;
        }

        .active-block {
            background: linear-gradient(45deg, rgba(78, 205, 196, 0.1), rgba(255, 107, 107, 0.1));
            border: 2px solid #4ecdc4;
            border-radius: 8px;
        }

        .block-controls {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #4ecdc4;
        }

        .block-controls.active {
            display: block;
        }

        .block-controls h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mini-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mini-control {
            display: flex;
            flex-direction: column;
        }

        .mini-control label {
            font-size: 0.8em;
            margin-bottom: 5px;
            color: #666;
        }

        .mini-control input, .mini-control select {
            padding: 6px;
            font-size: 0.85em;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .download-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 30px;
        }

        .download-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.85em;
        }

        .download-btn.primary {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
        }

        .download-btn.secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .upload-area {
            border: 2px dashed #4ecdc4;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            background-color: rgba(78, 205, 196, 0.1);
        }

        .upload-area.dragover {
            background-color: rgba(78, 205, 196, 0.2);
            border-color: #ff6b6b;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
            
            .templates-panel {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
                max-height: 200px;
            }
            
            .controls-panel {
                border-left: none;
                border-top: 1px solid #e9ecef;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® Toi-Shashu.kz</h1>
            <p>–ñ–∞“£–∞ –±—É—ã–Ω–Ω—ã“£ —à–∞“õ—ã—Ä—É –∫–∞—Ä—Ç–∞—Å—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã</p>
        </div>
        
        <div class="main-content">
            <div class="templates-panel">
                <h3>üé® –®–∞–±–ª–æ–Ω—ã</h3>
                
                <div class="upload-area" id="uploadArea">
                    <div>üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</div>
                    <small>JPG, PNG –¥–æ 5MB</small>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                </div>
                
                <div class="template-item active" data-template="wedding" 
                     style="background-image: url('./img/wedding.jpg')">
                    <div class="template-name">–°–≤–∞–¥—å–±–∞</div>
                </div>
                
                <div class="template-item" data-template="birthday" 
                     style="background-image: url('./img/birthday.jpg')">
                    <div class="template-name">–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                </div>
                
                <div class="template-item" data-template="party" 
                     style="background-image: url('./img/party.jpg')">
                    <div class="template-name">–í–µ—á–µ—Ä–∏–Ω–∫–∞</div>
                </div>
                
                <div class="template-item" data-template="graduation" 
                     style="background-image: url('./img/graduation.jpg')">
                    <div class="template-name">–í—ã–ø—É—Å–∫–Ω–æ–π</div>
                </div>
                
                <div class="template-item" data-template="christmas" 
                     style="background-image: url('./img/christmas.jpg')">
                    <div class="template-name">–ù–æ–≤—ã–π –≥–æ–¥</div>
                </div>
                
                <div class="template-item" data-template="business" 
                     style="background-image: url('./img/business.jpg')">
                    <div class="template-name">–î–µ–ª–æ–≤–æ–µ</div>
                </div>
                
                <div class="template-item" data-template="elegant" 
                     style="background-image: url('./img/elegant.jpg')">
                    <div class="template-name">–≠–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ</div>
                </div>
                
                <div class="template-item" data-template="traditional" 
                     style="background-image: url('./img/traditional.jpg')">
                    <div class="template-name">–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π</div>
                </div>
                
                <div class="template-item" data-template="modern" 
                     style="background-image: url('./img/modern.jpg')">
                    <div class="template-name">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π</div>
                </div>
                
                <div class="template-item" data-template="floral" 
                     style="background-image: url('./img/floral.jpg')">
                    <div class="template-name">–¶–≤–µ—Ç–æ—á–Ω—ã–π</div>
                </div>
            </div>
            
            <div class="canvas-area">
                <div class="canvas-container">
                    <canvas id="canvas" width="400" height="600"></canvas>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="control-group">
                    <label>üë• –®–∞“õ—ã—Ä—Ç—É –∏–µ–ª–µ—Ä—ñ</label>
                    <input type="text" id="invitationTo" placeholder="“ö“±—Ä–º–µ—Ç—Ç—ñ –¥–æ—Å—Ç–∞—Ä –º–µ–Ω ”ô—Ä—ñ–ø—Ç–µ—Å—Ç–µ—Ä..." value="“ö“±—Ä–º–µ—Ç—Ç—ñ –¥–æ—Å—Ç–∞—Ä –º–µ–Ω ”ô—Ä—ñ–ø—Ç–µ—Å—Ç–µ—Ä!">
                    <div class="block-controls" id="invitationTo-controls">
                        <h4>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–∫–∞: –®–∞“õ—ã—Ä—Ç—É –∏–µ–ª–µ—Ä—ñ</h4>
                        <div class="mini-controls">
                            <div class="mini-control">
                                <label>–†–∞–∑–º–µ—Ä</label>
                                <input type="range" id="invitationTo-fontSize" min="12" max="36" value="16">
                                <small id="invitationTo-fontSize-value">16px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®–∏—Ä–∏–Ω–∞</label>
                                <input type="range" id="invitationTo-textWidth" min="150" max="380" value="300">
                                <small id="invitationTo-textWidth-value">300px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®—Ä–∏—Ñ—Ç</label>
                                <select id="invitationTo-fontFamily">
                                    <option value="'Noto Sans', Arial, sans-serif">Noto Sans</option>
                                    <option value="'Noto Serif', Georgia, serif">Noto Serif</option>
                                    <option value="'Roboto', Arial, sans-serif">Roboto</option>
                                    <option value="'Playfair Display', Georgia, serif">Playfair Display</option>
                                </select>
                            </div>
                            <div class="mini-control">
                                <label>–¶–≤–µ—Ç</label>
                                <input type="color" id="invitationTo-color" value="#ffffff">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>üìù –®–∞“õ—ã—Ä—Ç—É –º”ô—Ç—ñ–Ω—ñ</label>
                    <textarea id="mainText" placeholder="–ù–µ–≥—ñ–∑–≥—ñ —à–∞“õ—ã—Ä—É –º”ô—Ç—ñ–Ω—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑...">–°—ñ–∑–¥–µ—Ä–¥—ñ, –º–µ—Ä–µ–π–ª—ñ 50 –∂–∞—Å –º–µ—Ä–µ–π—Ç–æ–π—ã–º—ã–∑ –∞—Ä–Ω–∞–π—ã –∂–∞–π—ã–ª“ì–∞–Ω –¥–∞—Å—Ç–∞—Ä—Ö–∞–Ω—ã–º—ã–∑–Ω—ã“£ “õ–∞–¥—ñ—Ä–ª—ñ “õ–æ–Ω–∞“ì—ã –±–æ–ª—É“ì–∞ —à–∞“õ—ã—Ä–∞–º—ã–∑!</textarea>
                    <div class="block-controls" id="mainText-controls">
                        <h4>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–∫–∞: –®–∞“õ—ã—Ä—Ç—É –º”ô—Ç—ñ–Ω—ñ</h4>
                        <div class="mini-controls">
                            <div class="mini-control">
                                <label>–†–∞–∑–º–µ—Ä</label>
                                <input type="range" id="mainText-fontSize" min="16" max="48" value="24">
                                <small id="mainText-fontSize-value">24px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®–∏—Ä–∏–Ω–∞</label>
                                <input type="range" id="mainText-textWidth" min="200" max="380" value="340">
                                <small id="mainText-textWidth-value">340px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®—Ä–∏—Ñ—Ç</label>
                                <select id="mainText-fontFamily">
                                    <option value="'Noto Sans', Arial, sans-serif">Noto Sans</option>
                                    <option value="'Noto Serif', Georgia, serif">Noto Serif</option>
                                    <option value="'Roboto', Arial, sans-serif">Roboto</option>
                                    <option value="'Playfair Display', Georgia, serif">Playfair Display</option>
                                </select>
                            </div>
                            <div class="mini-control">
                                <label>–¶–≤–µ—Ç</label>
                                <input type="color" id="mainText-color" value="#ffffff">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>‚è∞ –£–∞“õ—ã—Ç—ã</label>
                    <input type="text" id="dateTime" placeholder="12 “õ–∞“£—Ç–∞—Ä / —Å–∞“ì–∞—Ç 19:30" value="12 “õ–∞“£—Ç–∞—Ä / —Å–∞“ì–∞—Ç 19:30">
                    <div class="block-controls" id="dateTime-controls">
                        <h4>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–∫–∞: –£–∞“õ—ã—Ç—ã</h4>
                        <div class="mini-controls">
                            <div class="mini-control">
                                <label>–†–∞–∑–º–µ—Ä</label>
                                <input type="range" id="dateTime-fontSize" min="14" max="40" value="19">
                                <small id="dateTime-fontSize-value">19px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®–∏—Ä–∏–Ω–∞</label>
                                <input type="range" id="dateTime-textWidth" min="180" max="380" value="320">
                                <small id="dateTime-textWidth-value">320px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®—Ä–∏—Ñ—Ç</label>
                                <select id="dateTime-fontFamily">
                                    <option value="'Noto Sans', Arial, sans-serif">Noto Sans</option>
                                    <option value="'Noto Serif', Georgia, serif">Noto Serif</option>
                                    <option value="'Roboto', Arial, sans-serif">Roboto</option>
                                    <option value="'Playfair Display', Georgia, serif">Playfair Display</option>
                                </select>
                            </div>
                            <div class="mini-control">
                                <label>–¶–≤–µ—Ç</label>
                                <input type="color" id="dateTime-color" value="#ffffff">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>üìç –ú–µ–∫–µ–Ω-–∂–∞–π—ã–º—ã–∑</label>
                    <input type="text" id="location" placeholder="–ñ–µ—Ç—ñ–±–∞–π –∞—É—ã–ª—ã, '–î–æ—Å—Ç—ã“õ' –º–µ–π—Ä–∞–º—Ö–∞–Ω–∞—Å—ã" value="–ñ–µ—Ç—ñ–±–∞–π –∞—É—ã–ª—ã, '–î–æ—Å—Ç—ã“õ' –º–µ–π—Ä–∞–º—Ö–∞–Ω–∞—Å—ã">
                    <div class="block-controls" id="location-controls">
                        <h4>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–∫–∞: –ú–µ–∫–µ–Ω-–∂–∞–π—ã–º—ã–∑</h4>
                        <div class="mini-controls">
                            <div class="mini-control">
                                <label>–†–∞–∑–º–µ—Ä</label>
                                <input type="range" id="location-fontSize" min="12" max="32" value="17">
                                <small id="location-fontSize-value">17px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®–∏—Ä–∏–Ω–∞</label>
                                <input type="range" id="location-textWidth" min="160" max="380" value="310">
                                <small id="location-textWidth-value">310px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®—Ä–∏—Ñ—Ç</label>
                                <select id="location-fontFamily">
                                    <option value="'Noto Sans', Arial, sans-serif">Noto Sans</option>
                                    <option value="'Noto Serif', Georgia, serif">Noto Serif</option>
                                    <option value="'Roboto', Arial, sans-serif">Roboto</option>
                                    <option value="'Playfair Display', Georgia, serif">Playfair Display</option>
                                </select>
                            </div>
                            <div class="mini-control">
                                <label>–¶–≤–µ—Ç</label>
                                <input type="color" id="location-color" value="#ffffff">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>üé≠ –¢–æ–π –∏–µ–ª–µ—Ä—ñ</label>
                    <input type="text" id="hosts" placeholder="–ï—Ä–∂–∞–Ω - –ì“Ø–ª—à–∞—Ç" value="–¢–æ–π –∏–µ–ª–µ—Ä—ñ: –ï—Ä–∂–∞–Ω - –ì“Ø–ª—à–∞—Ç">
                    <div class="block-controls" id="hosts-controls">
                        <h4>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–∫–∞: –¢–æ–π –∏–µ–ª–µ—Ä—ñ</h4>
                        <div class="mini-controls">
                            <div class="mini-control">
                                <label>–†–∞–∑–º–µ—Ä</label>
                                <input type="range" id="hosts-fontSize" min="12" max="36" value="18">
                                <small id="hosts-fontSize-value">18px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®–∏—Ä–∏–Ω–∞</label>
                                <input type="range" id="hosts-textWidth" min="170" max="380" value="320">
                                <small id="hosts-textWidth-value">320px</small>
                            </div>
                            <div class="mini-control">
                                <label>–®—Ä–∏—Ñ—Ç</label>
                                <select id="hosts-fontFamily">
                                    <option value="'Noto Sans', Arial, sans-serif">Noto Sans</option>
                                    <option value="'Noto Serif', Georgia, serif">Noto Serif</option>
                                    <option value="'Roboto', Arial, sans-serif">Roboto</option>
                                    <option value="'Playfair Display', Georgia, serif">Playfair Display</option>
                                </select>
                            </div>
                            <div class="mini-control">
                                <label>–¶–≤–µ—Ç</label>
                                <input type="color" id="hosts-color" value="#ffffff">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label>‚ú® –°—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞</label>
                    <div class="text-controls">
                        <button class="text-style-btn" id="boldBtn">B</button>
                        <button class="text-style-btn" id="italicBtn" style="font-style: italic;">I</button>
                    </div>
                </div>

                <div class="control-group">
                    <label>üìç –ü–æ–∑–∏—Ü–∏—è —Ç–µ–∫—Å—Ç–∞</label>
                    <div class="text-controls">
                        <button class="text-style-btn" id="resetPosBtn">‚Ü∫ –°–±—Ä–æ—Å</button>
                        <button class="text-style-btn" id="centerBtn">‚äû –¶–µ–Ω—Ç—Ä</button>
                    </div>
                    <small>üí° –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ç–µ–∫—Å—Ç –º—ã—à–∫–æ–π –ø—Ä—è–º–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏</small>
                </div>

                <div class="control-group">
                    <label>üìê –ú–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª</label>
                    <input type="range" id="lineSpacing" min="1.0" max="2.5" step="0.1" value="1.2" class="range-input">
                    <small id="lineSpacingValue">1.2</small>
                </div>
                
                <div class="control-group">
                    <label>üå´Ô∏è –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞</label>
                    <input type="range" id="overlayOpacity" min="0" max="80" value="30" class="range-input">
                    <small id="overlayValue">30%</small>
                </div>
                
                <div class="download-buttons">
                    <button class="download-btn primary" onclick="downloadImage('png')">PNG</button>
                    <button class="download-btn primary" onclick="downloadImage('jpg')">JPG</button>
                    <button class="download-btn secondary" onclick="downloadPDF()">PDF</button>
                    <button class="download-btn secondary" onclick="saveProject()">–°–û–•–†–ê–ù–ò–¢–¨</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let currentTemplate = 'wedding';
        let currentBackgroundImage = null;
        let customImage = null;
        let isBold = false;
        let isItalic = false;
        
        // –ü–æ–∑–∏—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
        let textPositions = {
            invitationTo: { x: 200, y: 120 },    // –®–∞“õ—ã—Ä—Ç—É –∏–µ–ª–µ—Ä—ñ
            mainText: { x: 200, y: 220 },        // –®–∞“õ—ã—Ä—Ç—É –º”ô—Ç—ñ–Ω—ñ
            dateTime: { x: 200, y: 320 },        // –£–∞“õ—ã—Ç—ã
            location: { x: 200, y: 400 },        // –ú–µ–∫–µ–Ω-–∂–∞–π—ã–º—ã–∑
            hosts: { x: 200, y: 500 }            // –¢–æ–π –∏–µ–ª–µ—Ä—ñ
        };
        
        let isDragging = false;
        let dragTarget = null;
        let lastMousePos = { x: 0, y: 0 };
        let activeBlock = null;
        
        // –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞
        let blockSettings = {
            invitationTo: { fontSize: 16, textWidth: 300, fontFamily: "'Noto Sans', Arial, sans-serif", color: '#ffffff' },
            mainText: { fontSize: 24, textWidth: 340, fontFamily: "'Noto Sans', Arial, sans-serif", color: '#ffffff' },
            dateTime: { fontSize: 19, textWidth: 320, fontFamily: "'Noto Sans', Arial, sans-serif", color: '#ffffff' },
            location: { fontSize: 17, textWidth: 310, fontFamily: "'Noto Sans', Arial, sans-serif", color: '#ffffff' },
            hosts: { fontSize: 18, textWidth: 320, fontFamily: "'Noto Sans', Arial, sans-serif", color: '#ffffff' }
        };
        
        const templateImages = {
            wedding: './img/wedding.jpg',
            birthday: './img/birthday.jpg',
            party: './img/party.jpg',
            graduation: './img/graduation.jpg',
            christmas: './img/christmas.jpg',
            business: './img/business.jpg',
            elegant: './img/elegant.jpg',
            traditional: './img/traditional.jpg',
            modern: './img/modern.jpg',
            floral: './img/floral.jpg'
        };
        
        function loadBackgroundImage(imageSrc, callback) {
            const img = new Image();
            // –£–±–∏—Ä–∞–µ–º crossOrigin –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            // img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                currentBackgroundImage = img;
                console.log('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ:', imageSrc);
                if (callback) callback();
            };
            
            img.onerror = function() {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', imageSrc);
                // –ü–æ–ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ Unsplash
                const fallbackImages = {
                    wedding: 'https://images.unsplash.com/photo-1511285560929-80b456fea0bc?w=400&h=600&fit=crop',
                    birthday: 'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=400&h=600&fit=crop',
                    party: 'https://images.unsplash.com/photo-1464207687429-7505649dae38?w=400&h=600&fit=crop',
                    graduation: 'https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=600&fit=crop',
                    christmas: 'https://images.unsplash.com/photo-1512389142860-9c449e58a543?w=400&h=600&fit=crop',
                    business: 'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=400&h=600&fit=crop',
                    elegant: 'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=400&h=600&fit=crop'
                };
                
                // –ù–∞–π–¥–µ–º –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                let fallbackSrc = null;
                for (let template in templateImages) {
                    if (templateImages[template] === imageSrc && fallbackImages[template]) {
                        fallbackSrc = fallbackImages[template];
                        break;
                    }
                }
                
                if (fallbackSrc) {
                    console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:', fallbackSrc);
                    const fallbackImg = new Image();
                    fallbackImg.crossOrigin = 'anonymous';
                    fallbackImg.onload = function() {
                        currentBackgroundImage = fallbackImg;
                        if (callback) callback();
                    };
                    fallbackImg.onerror = function() {
                        console.error('–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∂–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å');
                        currentBackgroundImage = null;
                        if (callback) callback();
                    };
                    fallbackImg.src = fallbackSrc;
                } else {
                    // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑–µ—Ä–≤
                    currentBackgroundImage = null;
                    if (callback) callback();
                }
            };
            
            img.src = imageSrc;
        }
        
        function drawBackground() {
            if (currentBackgroundImage) {
                // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º —Å—Ç–æ—Ä–æ–Ω
                const imgAspect = currentBackgroundImage.width / currentBackgroundImage.height;
                const canvasAspect = canvas.width / canvas.height;
                
                let drawWidth, drawHeight, offsetX, offsetY;
                
                if (imgAspect > canvasAspect) {
                    drawHeight = canvas.height;
                    drawWidth = drawHeight * imgAspect;
                    offsetX = (canvas.width - drawWidth) / 2;
                    offsetY = 0;
                } else {
                    drawWidth = canvas.width;
                    drawHeight = drawWidth / imgAspect;
                    offsetX = 0;
                    offsetY = (canvas.height - drawHeight) / 2;
                }
                
                ctx.drawImage(currentBackgroundImage, offsetX, offsetY, drawWidth, drawHeight);
            } else {
                // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#ff9a9e');
                gradient.addColorStop(1, '#fad0c4');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            // –ó–∞—Ç–µ–º–Ω—è—é—â–∏–π —Å–ª–æ–π
            const overlayOpacity = document.getElementById('overlayOpacity').value / 100;
            ctx.fillStyle = `rgba(0, 0, 0, ${overlayOpacity})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        function wrapText(text, x, y, maxWidth, lineHeight, getId = null) {
            if (!text.trim()) return y;
            
            const words = text.split(' ');
            let line = '';
            const lines = [];
            let currentY = y;
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–∫–∞
            const blockTextWidth = getId ? blockSettings[getId].textWidth : parseInt(document.getElementById('textWidth')?.value || 340);
            const actualMaxWidth = Math.min(maxWidth, blockTextWidth);
            
            for(let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > actualMaxWidth && n > 0) {
                    lines.push({text: line.trim(), y: currentY});
                    line = words[n] + ' ';
                    currentY += lineHeight;
                } else {
                    line = testLine;
                }
            }
            lines.push({text: line.trim(), y: currentY});
            
            // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –∫–ª–∏–∫–∞
            const totalHeight = lines.length * lineHeight;
            const startY = y - totalHeight / 2;
            
            if (getId) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–ª–∞—Å—Ç—å –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –∫–ª–∏–∫–∞
                const textBounds = {
                    x: x - actualMaxWidth/2,
                    y: startY - lineHeight/2,
                    width: actualMaxWidth,
                    height: totalHeight + lineHeight,
                    id: getId
                };
                
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∏–ª–∏ –µ—Å–ª–∏ –±–ª–æ–∫ –∞–∫—Ç–∏–≤–µ–Ω
                if (dragTarget === getId || activeBlock === getId) {
                    ctx.save();
                    ctx.fillStyle = activeBlock === getId ? 'rgba(78, 205, 196, 0.3)' : 'rgba(255, 255, 255, 0.2)';
                    ctx.fillRect(textBounds.x, textBounds.y, textBounds.width, textBounds.height);
                    ctx.strokeStyle = activeBlock === getId ? 'rgba(78, 205, 196, 0.8)' : 'rgba(255, 255, 255, 0.5)';
                    ctx.lineWidth = activeBlock === getId ? 3 : 2;
                    ctx.strokeRect(textBounds.x, textBounds.y, textBounds.width, textBounds.height);
                    ctx.restore();
                }
                
                canvas.textBounds = canvas.textBounds || [];
                canvas.textBounds.push(textBounds);
            }
            
            lines.forEach((lineObj, index) => {
                ctx.fillText(lineObj.text, x, startY + (index * lineHeight));
            });
            
            return currentY + lineHeight;
        }
        
        function updateCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            canvas.textBounds = []; // –û—á–∏—â–∞–µ–º –æ–±–ª–∞—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞
            
            // –§–æ–Ω
            drawBackground();
            
            // –¢–µ–∫—Å—Ç
            const invitationTo = document.getElementById('invitationTo').value;
            const mainText = document.getElementById('mainText').value;
            const dateTime = document.getElementById('dateTime').value;
            const location = document.getElementById('location').value;
            const hosts = document.getElementById('hosts').value;
            const lineSpacing = parseFloat(document.getElementById('lineSpacing')?.value || 1.2);
            
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –æ–±—â–∏—Ö —Å—Ç–∏–ª–µ–π
            let fontStyle = '';
            if (isItalic) fontStyle += 'italic ';
            if (isBold) fontStyle += 'bold ';
            
            // 1. –®–∞“õ—ã—Ä—Ç—É –∏–µ–ª–µ—Ä—ñ
            const invitationToSettings = blockSettings.invitationTo;
            ctx.fillStyle = invitationToSettings.color;
            ctx.font = `${fontStyle}${invitationToSettings.fontSize}px ${invitationToSettings.fontFamily}`;
            const invitationToLineHeight = (invitationToSettings.fontSize + 6) * lineSpacing;
            wrapText(invitationTo, textPositions.invitationTo.x, textPositions.invitationTo.y, canvas.width - 60, invitationToLineHeight, 'invitationTo');
            
            // 2. –®–∞“õ—ã—Ä—Ç—É –º”ô—Ç—ñ–Ω—ñ (–æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç)
            const mainTextSettings = blockSettings.mainText;
            ctx.fillStyle = mainTextSettings.color;
            ctx.font = `${fontStyle}${mainTextSettings.fontSize}px ${mainTextSettings.fontFamily}`;
            const mainLineHeight = (mainTextSettings.fontSize + 10) * lineSpacing;
            wrapText(mainText, textPositions.mainText.x, textPositions.mainText.y, canvas.width - 60, mainLineHeight, 'mainText');
            
            // 3. –£–∞“õ—ã—Ç—ã (–¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è)
            const dateTimeSettings = blockSettings.dateTime;
            ctx.fillStyle = dateTimeSettings.color;
            ctx.font = `${fontStyle}${dateTimeSettings.fontSize}px ${dateTimeSettings.fontFamily}`;
            const dateTimeLineHeight = (dateTimeSettings.fontSize + 8) * lineSpacing;
            wrapText(dateTime, textPositions.dateTime.x, textPositions.dateTime.y, canvas.width - 60, dateTimeLineHeight, 'dateTime');
            
            // 4. –ú–µ–∫–µ–Ω-–∂–∞–π—ã–º—ã–∑ (–º–µ—Å—Ç–æ)
            const locationSettings = blockSettings.location;
            ctx.fillStyle = locationSettings.color;
            ctx.font = `${fontStyle}${locationSettings.fontSize}px ${locationSettings.fontFamily}`;
            const locationLineHeight = (locationSettings.fontSize + 6) * lineSpacing;
            wrapText(location, textPositions.location.x, textPositions.location.y, canvas.width - 60, locationLineHeight, 'location');
            
            // 5. –¢–æ–π –∏–µ–ª–µ—Ä—ñ (—Ö–æ–∑—è–µ–≤–∞ —Ç–æ—Ä–∂–µ—Å—Ç–≤–∞)
            const hostsSettings = blockSettings.hosts;
            ctx.fillStyle = hostsSettings.color;
            ctx.font = `${fontStyle}${hostsSettings.fontSize}px ${hostsSettings.fontFamily}`;
            const hostsLineHeight = (hostsSettings.fontSize + 7) * lineSpacing;
            wrapText(hosts, textPositions.hosts.x, textPositions.hosts.y, canvas.width - 60, hostsLineHeight, 'hosts');
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            return {
                x: (e.clientX - rect.left) * scaleX,
                y: (e.clientY - rect.top) * scaleY
            };
        }
        
        function getTextAtPosition(x, y) {
            if (!canvas.textBounds) return null;
            
            for (let bound of canvas.textBounds) {
                if (x >= bound.x && x <= bound.x + bound.width &&
                    y >= bound.y && y <= bound.y + bound.height) {
                    return bound.id;
                }
            }
            return null;
        }
        
        // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è
        canvas.addEventListener('mousedown', function(e) {
            const mousePos = getMousePos(e);
            const textId = getTextAtPosition(mousePos.x, mousePos.y);
            
            if (textId) {
                isDragging = true;
                dragTarget = textId;
                lastMousePos = mousePos;
                canvas.style.cursor = 'grabbing';
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –±–ª–æ–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                setActiveBlock(textId);
                e.preventDefault();
            }
        });
        
        function setActiveBlock(blockId) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤
            document.querySelectorAll('.control-group').forEach(group => {
                group.classList.remove('active-block');
            });
            document.querySelectorAll('.block-controls').forEach(control => {
                control.classList.remove('active');
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±–ª–æ–∫
            if (blockId) {
                activeBlock = blockId;
                const blockInput = document.getElementById(blockId);
                if (blockInput) {
                    blockInput.closest('.control-group').classList.add('active-block');
                    document.getElementById(blockId + '-controls').classList.add('active');
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –∞–∫—Ç–∏–≤–Ω–æ–º—É –±–ª–æ–∫—É
                    blockInput.closest('.control-group').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }
                updateCanvas();
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–ª–æ–∫–æ–≤
        function setupBlockControls() {
            const blocks = ['invitationTo', 'mainText', 'dateTime', 'location', 'hosts'];
            
            blocks.forEach(blockId => {
                // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
                const fontSizeSlider = document.getElementById(blockId + '-fontSize');
                const fontSizeValue = document.getElementById(blockId + '-fontSize-value');
                fontSizeSlider.addEventListener('input', function() {
                    blockSettings[blockId].fontSize = parseInt(this.value);
                    fontSizeValue.textContent = this.value + 'px';
                    updateCanvas();
                });
                
                // –®–∏—Ä–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞
                const textWidthSlider = document.getElementById(blockId + '-textWidth');
                const textWidthValue = document.getElementById(blockId + '-textWidth-value');
                textWidthSlider.addEventListener('input', function() {
                    blockSettings[blockId].textWidth = parseInt(this.value);
                    textWidthValue.textContent = this.value + 'px';
                    updateCanvas();
                });
                
                // –®—Ä–∏—Ñ—Ç
                document.getElementById(blockId + '-fontFamily').addEventListener('change', function() {
                    blockSettings[blockId].fontFamily = this.value;
                    updateCanvas();
                });
                
                // –¶–≤–µ—Ç
                document.getElementById(blockId + '-color').addEventListener('change', function() {
                    blockSettings[blockId].color = this.value;
                    updateCanvas();
                });
                
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è HTML —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
                fontSizeSlider.value = blockSettings[blockId].fontSize;
                fontSizeValue.textContent = blockSettings[blockId].fontSize + 'px';
                textWidthSlider.value = blockSettings[blockId].textWidth;
                textWidthValue.textContent = blockSettings[blockId].textWidth + 'px';
                document.getElementById(blockId + '-color').value = blockSettings[blockId].color;
            });
        }
        
        canvas.addEventListener('mousemove', function(e) {
            const mousePos = getMousePos(e);
            
            if (isDragging && dragTarget) {
                const deltaX = mousePos.x - lastMousePos.x;
                const deltaY = mousePos.y - lastMousePos.y;
                
                textPositions[dragTarget].x += deltaX;
                textPositions[dragTarget].y += deltaY;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö canvas
                textPositions[dragTarget].x = Math.max(30, Math.min(canvas.width - 30, textPositions[dragTarget].x));
                textPositions[dragTarget].y = Math.max(30, Math.min(canvas.height - 30, textPositions[dragTarget].y));
                
                lastMousePos = mousePos;
                updateCanvas();
            } else {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∫—É—Ä—Å–æ—Ä –Ω–∞–¥ —Ç–µ–∫—Å—Ç–æ–º
                const textId = getTextAtPosition(mousePos.x, mousePos.y);
                if (textId) {
                    canvas.style.cursor = 'grab';
                    if (dragTarget !== textId) {
                        dragTarget = textId;
                        updateCanvas();
                    }
                } else {
                    canvas.style.cursor = 'default';
                    if (dragTarget) {
                        dragTarget = null;
                        updateCanvas();
                    }
                }
            }
        });
        
        canvas.addEventListener('mouseup', function() {
            isDragging = false;
            canvas.style.cursor = dragTarget ? 'grab' : 'default';
        });
        
        canvas.addEventListener('mouseleave', function() {
            isDragging = false;
            dragTarget = null;
            canvas.style.cursor = 'default';
            updateCanvas();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
        document.querySelectorAll('.template-item').forEach(item => {
            item.addEventListener('click', function() {
                if (this.dataset.template) {
                    console.log('–í—ã–±—Ä–∞–Ω —à–∞–±–ª–æ–Ω:', this.dataset.template);
                    document.querySelector('.template-item.active').classList.remove('active');
                    this.classList.add('active');
                    currentTemplate = this.dataset.template;
                    customImage = null;
                    // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —à–∞–±–ª–æ–Ω–∞
                    resetTextPositions();
                    
                    const imagePath = templateImages[currentTemplate];
                    console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:', imagePath);
                    loadBackgroundImage(imagePath, updateCanvas);
                }
            });
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        function handleFileUpload(file) {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.querySelector('.template-item.active').classList.remove('active');
                    customImage = e.target.result;
                    loadBackgroundImage(customImage, updateCanvas);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
        document.getElementById('invitationTo').addEventListener('input', updateCanvas);
        document.getElementById('mainText').addEventListener('input', updateCanvas);
        document.getElementById('dateTime').addEventListener('input', updateCanvas);
        document.getElementById('location').addEventListener('input', updateCanvas);
        document.getElementById('hosts').addEventListener('input', updateCanvas);
        document.getElementById('textColor')?.addEventListener('change', updateCanvas);
        document.getElementById('fontSize')?.addEventListener('input', updateCanvas);
        document.getElementById('fontFamily')?.addEventListener('change', updateCanvas);
        
        document.getElementById('overlayOpacity').addEventListener('input', function() {
            document.getElementById('overlayValue').textContent = this.value + '%';
            updateCanvas();
        });
        
        document.getElementById('lineSpacing').addEventListener('input', function() {
            document.getElementById('lineSpacingValue').textContent = this.value;
            updateCanvas();
        });
        
        // –°—Ç–∏–ª–∏ —Ç–µ–∫—Å—Ç–∞
        document.getElementById('boldBtn').addEventListener('click', function() {
            isBold = !isBold;
            this.classList.toggle('active', isBold);
            updateCanvas();
        });
        
        document.getElementById('italicBtn').addEventListener('click', function() {
            isItalic = !isItalic;
            this.classList.toggle('active', isItalic);
            updateCanvas();
        });
        
        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–µ–π
        document.getElementById('resetPosBtn').addEventListener('click', function() {
            resetTextPositions();
            updateCanvas();
        });
        
        document.getElementById('centerBtn').addEventListener('click', function() {
            centerTextPositions();
            updateCanvas();
        });
        
        function resetTextPositions() {
            textPositions = {
                invitationTo: { x: canvas.width / 2, y: canvas.height * 0.15 },  // 15% –æ—Ç –≤–µ—Ä—Ö–∞
                mainText: { x: canvas.width / 2, y: canvas.height * 0.4 },       // 40% –æ—Ç –≤–µ—Ä—Ö–∞
                dateTime: { x: canvas.width / 2, y: canvas.height * 0.65 },      // 65% –æ—Ç –≤–µ—Ä—Ö–∞
                location: { x: canvas.width / 2, y: canvas.height * 0.8 },       // 80% –æ—Ç –≤–µ—Ä—Ö–∞  
                hosts: { x: canvas.width / 2, y: canvas.height * 0.92 }          // 92% –æ—Ç –≤–µ—Ä—Ö–∞
            };
        }
        
        function centerTextPositions() {
            textPositions.invitationTo.x = canvas.width / 2;
            textPositions.mainText.x = canvas.width / 2;
            textPositions.dateTime.x = canvas.width / 2;
            textPositions.location.x = canvas.width / 2;
            textPositions.hosts.x = canvas.width / 2;
        }
        
        function downloadImage(format) {
            const link = document.createElement('a');
            link.download = `invitation.${format}`;
            
            if (format === 'jpg') {
                // –î–ª—è JPG —Å–æ–∑–¥–∞–µ–º –±–µ–ª—ã–π —Ñ–æ–Ω
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                
                tempCtx.fillStyle = 'white';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.drawImage(canvas, 0, 0);
                
                link.href = tempCanvas.toDataURL('image/jpeg', 0.9);
            } else {
                link.href = canvas.toDataURL(`image/${format}`);
            }
            
            link.click();
        }
        
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgData = canvas.toDataURL('image/png');
            
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            const canvasAspectRatio = canvas.width / canvas.height;
            const pdfAspectRatio = pdfWidth / pdfHeight;
            
            let renderWidth, renderHeight;
            
            if (canvasAspectRatio < pdfAspectRatio) {
                renderHeight = pdfHeight;
                renderWidth = pdfHeight * canvasAspectRatio;
            } else {
                renderWidth = pdfWidth;
                renderHeight = pdfWidth / canvasAspectRatio;
            }
            
            const x = (pdfWidth - renderWidth) / 2;
            const y = (pdfHeight - renderHeight) / 2;
            
            pdf.addImage(imgData, 'PNG', x, y, renderWidth, renderHeight);
            pdf.save('invitation.pdf');
        }
        
        function saveProject() {
            const projectData = {
                template: currentTemplate,
                customImage: customImage,
                textPositions: textPositions,
                blockSettings: blockSettings,
                invitationTo: document.getElementById('invitationTo').value,
                mainText: document.getElementById('mainText').value,
                dateTime: document.getElementById('dateTime').value,
                location: document.getElementById('location').value,
                hosts: document.getElementById('hosts').value,
                fontSize: document.getElementById('fontSize')?.value,
                textWidth: document.getElementById('textWidth')?.value,
                lineSpacing: document.getElementById('lineSpacing').value,
                fontFamily: document.getElementById('fontFamily')?.value,
                isBold: isBold,
                isItalic: isItalic,
                overlayOpacity: document.getElementById('overlayOpacity').value
            };
            
            const dataStr = JSON.stringify(projectData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'invitation_project.json';
            link.click();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        resetTextPositions();
        setupBlockControls();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–µ—Ä–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
        const initialTemplate = templateImages[currentTemplate];
        console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω:', initialTemplate);
        loadBackgroundImage(initialTemplate, function() {
            console.log('–ù–∞—á–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º canvas');
            updateCanvas();
        });
    </script>
</body>
</html>